---
import '../styles/global.css';
import Search from '../components/Search.astro';
const { title } = Astro.props;

// 活动页面路径
const currentPath = Astro.url.pathname;
// const siteTitle = "CCJ Studio"; // Removed as it was unused
---
<!doctype html>
<html lang="zh-CN" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="林大反卷门驻地 - 一个专注于知识分享、技术探讨和个人成长的空间站" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <!-- KaTeX CSS - 确保完整的样式支持 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    <title>{title ? `${title} - 林大反卷门驻地` : '林大反卷门驻地'}</title>
  </head>
  <body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 flex flex-col min-h-screen transition-colors duration-200">
    <header class="bg-blue-600 text-white dark:bg-blue-800 shadow-md">
      <div class="container mx-auto p-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="flex items-center mb-4 md:mb-0">
            <a href="/" class="text-2xl font-bold">林大反卷门驻地</a>
          </div>
          <div class="flex items-center">
            <!-- 搜索组件 -->
            <div class="mr-4 w-full md:w-64 lg:w-80">
              <Search />
            </div>
            
            <!-- 桌面端导航 -->
            <nav class="mr-4 hidden md:flex items-center">
              <!-- 主导航项 -->
              <a 
                href="/" 
                class={`px-3 py-2 rounded-md mr-2 hover:bg-blue-500 transition-colors ${currentPath === '/' ? 'bg-blue-700' : ''}`}
              >
                首页
              </a>
              
              <!-- 内容下拉菜单 -->
              <div class="relative group mr-2">
                <button class="flex items-center px-3 py-2 rounded-md hover:bg-blue-500 transition-colors">
                  <span>内容</span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div id="content-dropdown" class="absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 z-10 hidden">
                  <div class="py-1">
                    <a 
                      href="/blog" 
                      class={`block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 ${currentPath === '/blog' || currentPath.startsWith('/blog/') ? 'bg-gray-100 dark:bg-gray-700' : ''}`}
                    >
                      博客文章
                    </a>
                    <a 
                      href="/notes" 
                      class={`block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 ${currentPath === '/notes' || currentPath.startsWith('/notes/') ? 'bg-gray-100 dark:bg-gray-700' : ''}`}
                    >
                      学习笔记
                    </a>
                    <a 
                      href="/vocabulary" 
                      class={`block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 ${currentPath === '/vocabulary' ? 'bg-gray-100 dark:bg-gray-700' : ''}`}
                    >
                      单词学习
                    </a>
                    <a 
                      href="/tags" 
                      class={`block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 ${currentPath === '/tags' ? 'bg-gray-100 dark:bg-gray-700' : ''}`}
                    >
                      标签云
                    </a>
                  </div>
                </div>
              </div>
              
              <!-- 关于链接 -->
              <a 
                href="/about" 
                class={`px-3 py-2 rounded-md hover:bg-blue-500 transition-colors ${currentPath === '/about' ? 'bg-blue-700' : ''}`}
              >
                关于
              </a>
            </nav>
            
            <!-- 移动端菜单按钮 -->
            <button id="mobile-menu-toggle" class="md:hidden p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
            
            <!-- 暗黑模式切换按钮 -->
            <button id="theme-toggle" class="rounded-full p-2 bg-blue-500 dark:bg-blue-700 hover:bg-blue-400 dark:hover:bg-blue-600">
              <svg xmlns="http://www.w3.org/2000/svg" id="sun-icon" class="h-5 w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" id="moon-icon" class="h-5 w-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            </button>
          </div>
        </div>
        
        <!-- 移动端菜单内容 -->
        <div id="mobile-menu" class="mt-4 hidden md:hidden">
          <nav class="flex flex-col space-y-2">
            <a 
              href="/" 
              class={`block py-2 px-4 rounded-md hover:bg-blue-700 ${currentPath === '/' ? 'font-bold bg-blue-700' : ''}`}
            >
              首页
            </a>
            <a 
              href="/blog" 
              class={`block py-2 px-4 rounded-md hover:bg-blue-700 ${currentPath === '/blog' || currentPath.startsWith('/blog/') ? 'font-bold bg-blue-700' : ''}`}
            >
              博客文章
            </a>
            <a 
              href="/notes" 
              class={`block py-2 px-4 rounded-md hover:bg-blue-700 ${currentPath === '/notes' || currentPath.startsWith('/notes/') ? 'font-bold bg-blue-700' : ''}`}
            >
              学习笔记
            </a>
            <a 
              href="/vocabulary" 
              class={`block py-2 px-4 rounded-md hover:bg-blue-700 ${currentPath === '/vocabulary' ? 'font-bold bg-blue-700' : ''}`}
            >
              单词学习
            </a>
            <a 
              href="/tags" 
              class={`block py-2 px-4 rounded-md hover:bg-blue-700 ${currentPath === '/tags' ? 'font-bold bg-blue-700' : ''}`}
            >
              标签云
            </a>
            <a 
              href="/about" 
              class={`block py-2 px-4 rounded-md hover:bg-blue-700 ${currentPath === '/about' ? 'font-bold bg-blue-700' : ''}`}
            >
              关于
            </a>
          </nav>
        </div>
      </div>
    </header>
    
    <main class="flex-grow container mx-auto p-6">
      <slot />
    </main>
    <footer class="bg-gray-800 text-white dark:bg-gray-950 p-6">
      <div class="container mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="mb-4 md:mb-0">
            <p>&copy; {new Date().getFullYear()} 林大反卷门驻地</p>
          </div>
          <div class="flex space-x-4">
            <a href="/about" class="hover:text-blue-300">关于</a>
            <a href="/blog" class="hover:text-blue-300">博客</a>
            <a href="/notes" class="hover:text-blue-300">笔记</a>
            <a href="/vocabulary" class="hover:text-blue-300">单词</a>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- KaTeX支持脚本 - 帮助处理复杂公式 -->
    <script is:inline defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    <script is:inline defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <!-- 暗黑模式切换脚本 -->
    <script>
      // 检查本地存储中的主题偏好
      const themeToggleBtn = document.getElementById('theme-toggle');
      const htmlElement = document.documentElement;
      
      // 检查用户之前的偏好
      if (localStorage.getItem('theme') === 'dark' || 
          (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        htmlElement.classList.add('dark');
      } else {
        htmlElement.classList.remove('dark');
      }
      
      // 添加切换事件
      if (themeToggleBtn) 
        themeToggleBtn.addEventListener('click', function() {
          if (htmlElement.classList.contains('dark')) {
            htmlElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
          } else {
          htmlElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        }
      });
      
      // 移动端菜单切换
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // 下拉菜单改进
      const contentDropdownParent = document.querySelector('.relative.group');
      const contentDropdown = document.getElementById('content-dropdown');
      let dropdownTimeout: NodeJS.Timeout | number | undefined;
      
      if (contentDropdownParent && contentDropdown) {
        // 鼠标进入父元素时显示下拉菜单
        contentDropdownParent.addEventListener('mouseenter', function() {
          clearTimeout(dropdownTimeout);
          contentDropdown.classList.remove('hidden');
        });
        
        // 鼠标离开时延迟隐藏
        contentDropdownParent.addEventListener('mouseleave', function() {
          dropdownTimeout = setTimeout(() => {
            contentDropdown.classList.add('hidden');
          }, 500); // 延迟500毫秒
        });
        
        // 鼠标进入下拉菜单时清除隐藏定时器
        contentDropdown.addEventListener('mouseenter', function() {
          clearTimeout(dropdownTimeout);
        });
        
        // 鼠标离开下拉菜单时延迟隐藏
        contentDropdown.addEventListener('mouseleave', function() {
          dropdownTimeout = setTimeout(() => {
            contentDropdown.classList.add('hidden');
          }, 300); // 延迟300毫秒
        });
        
        // 为移动设备添加点击切换功能
        const dropdownButton = contentDropdownParent?.querySelector('button');
        if (dropdownButton && contentDropdown) {
          dropdownButton.addEventListener('click', function(e) {
            e.preventDefault();
            contentDropdown.classList.toggle('hidden');
          });
        }
      }
    </script>
    <script is:inline>
      // 监听快捷键 (Ctrl + F1 to /developer)
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'F1') {
          e.preventDefault();
          window.location.href = '/developer';
        }
      });
    </script>
  </body>
</html>