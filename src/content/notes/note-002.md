---
title: "生成函数法解组合数学问题学习笔记"
description: "生成函数（母函数）在组合计数中的应用，OGF与EGF的理论与示例"
date: 2025-05-11
tags: ["生成函数", "OGF", "EGF","母函数"]
category: "组合数学"
draft: false
---

# 生成函数法解组合数学问题学习笔记

生成函数（Generating Function），又称母函数，是一种将组合问题中的计数序列与幂级数巧妙联系起来的工具。它将一个无限序列 $a_0, a_1, a_2, \dots$ 编码为一个形式幂级数 $A(x) = a_0 + a_1x + a_2x^2 + \dots = \sum_{n=0}^{\infty} a_n x^n$。通过对这些幂级数进行代数运算（如加法、乘法、求导、积分等），我们可以解决复杂的组合计数问题。生成函数的核心思想在于，我们不关心级数 $A(x)$ 本身是否收敛，而是将其视为一个代数对象，其系数 $a_n$ 承载着我们关心的组合对象的数量信息。


## 1. 普通生成函数 (Ordinary Generating Function, OGF)

### 1.1 定义

对于一个序列 $A = \{a_0, a_1, a_2, \dots, a_n, \dots\}$，它的普通生成函数定义为：

$$ A(x) = \sum_{n=0}^{\infty} a_n x^n $$

其中，$x$ 是一个形式变量，$a_n$ 是序列的第 $n$ 项，通常表示规模为 $n$ 的某种组合对象的个数。我们感兴趣的是 $x^n$ 的系数 $[x^n]A(x) = a_n$。


### 1.2 基本运算及其组合意义

假设有两个序列 $A = \{a_n\}$ 和 $B = \{b_n\}$，它们的OGF分别为 $A(x)$ 和 $B(x)$。

1.  **加法**: $C(x) = A(x) + B(x) = \sum_{n=0}^{\infty} (a_n + b_n) x^n$
    则 $C(x)$ 是序列 $\{a_n + b_n\}$ 的OGF。
    **组合意义**: 如果 $a_n$ 是从集合 $S_A$ 中选取 $n$ 个元素的方法数，$b_n$ 是从集合 $S_B$ (与 $S_A$ 不交) 中选取 $n$ 个元素的方法数，那么 $a_n + b_n$ 就是从 $S_A \cup S_B$ 中选取 $n$ 个元素的方法数。即“或”的关系。

2.  **数乘**: $C(x) = c \cdot A(x) = \sum_{n=0}^{\infty} (c \cdot a_n) x^n$
    则 $C(x)$ 是序列 $\{c \cdot a_n\}$ 的OGF。

3.  **乘法 (卷积)**: $C(x) = A(x)B(x) = (\sum_{i=0}^{\infty} a_i x^i)(\sum_{j=0}^{\infty} b_j x^j) = \sum_{n=0}^{\infty} (\sum_{k=0}^{n} a_k b_{n-k}) x^n$
    则 $C(x)$ 是序列 $C = \{c_n\}$ 的OGF，其中 $c_n = \sum_{k=0}^{n} a_k b_{n-k}$。
    **组合意义**: 这是生成函数威力最大的地方。如果 $a_k$ 是完成任务甲（得到 $k$ 个某种“单位”）的方法数，$b_{n-k}$ 是完成任务乙（得到 $n-k$ 个某种“单位”）的方法数，那么 $c_n$ 就是完成总任务（总共得到 $n$ 个“单位”，其中 $k$ 个来自任务甲，$n-k$ 个来自任务乙）的方法数。这常用于将一个问题分解为两个子问题。

4.  **移位**:
    *   $x^k A(x) = \sum_{n=0}^{\infty} a_n x^{n+k} = \sum_{m=k}^{\infty} a_{m-k} x^m$。这使得序列向右平移 $k$ 位，前面补 $0$。
    *   $\frac{A(x) - \sum_{i=0}^{k-1} a_i x^i}{x^k} = \sum_{n=k}^{\infty} a_n x^{n-k} = \sum_{m=0}^{\infty} a_{m+k} x^m$。这使得序列向左平移 $k$ 位。

5.  **求导**: $A'(x) = \frac{d}{dx} A(x) = \sum_{n=1}^{\infty} n a_n x^{n-1} = \sum_{m=0}^{\infty} (m+1) a_{m+1} x^m$
    则 $A'(x)$ 是序列 $\{ (n+1)a_{n+1} \}$ 的OGF。

6.  **积分**: $\int_0^x A(t) dt = \sum_{n=0}^{\infty} a_n \frac{x^{n+1}}{n+1} = \sum_{m=1}^{\infty} \frac{a_{m-1}}{m} x^m$
    则 $\int_0^x A(t) dt$ 是序列 $\{ \frac{a_{n-1}}{n} \}$ (约定 $a_{-1}=0$) 的OGF。


### 1.3 常见的OGF及其封闭形式

1.  序列 $\{1, 1, 1, \dots\}$ (即 $a_n=1$ 对所有 $n \ge 0$):
    $$ A(x) = 1 + x + x^2 + x^3 + \dots = \frac{1}{1-x} $$
    **组合意义**: 从一种物品中选取任意数量（0个，1个，2个...）的方法数。选 $k$ 个的方案数为1，对应 $x^k$ 的系数。

2.  序列 $\{1, c, c^2, \dots\}$ (即 $a_n=c^n$ 对所有 $n \ge 0$):
    $$ A(x) = 1 + cx + (cx)^2 + (cx)^3 + \dots = \frac{1}{1-cx} $$

3.  序列 $\{1, 0, 1, 0, 1, \dots\}$ (即 $a_n=1$ 若 $n$ 为偶数, $a_n=0$ 若 $n$ 为奇数):
    $$ A(x) = 1 + x^2 + x^4 + \dots = \frac{1}{1-x^2} $$

4.  序列 $\{0, 1, 0, 1, 0, \dots\}$ (即 $a_n=1$ 若 $n$ 为奇数, $a_n=0$ 若 $n$ 为偶数):
    $$ A(x) = x + x^3 + x^5 + \dots = x(1+x^2+x^4+\dots) = \frac{x}{1-x^2} $$

5.  序列 $\binom{m}{0}, \binom{m}{1}, \binom{m}{2}, \dots, \binom{m}{m}, 0, 0, \dots$ (有限序列， $m$ 为正整数):
    $$ A(x) = \sum_{n=0}^{m} \binom{m}{n} x^n = (1+x)^m $$
    (二项式定理)

6.  序列 $\binom{k-1}{k-1}, \binom{k}{k-1}, \binom{k+1}{k-1}, \dots$ (即 $a_n = \binom{n+k-1}{k-1}$ 或 $\binom{n+k-1}{n}$):
    $$ A(x) = \sum_{n=0}^{\infty} \binom{n+k-1}{n} x^n = \frac{1}{(1-x)^k} $$
    这是广义二项式定理 $(1-x)^{-k} = \sum_{n=0}^{\infty} \binom{-k}{n} (-x)^n = \sum_{n=0}^{\infty} \binom{n+k-1}{n} x^n$ 的一个特例。
    **组合意义**: 从 $k$ 种不同的物品中，每种物品有无限多个，选取 $n$ 个物品的方案数（可重复组合）。相当于将 $n$ 个无区别的球放入 $k$ 个有区别的盒子，允许空盒，即“插板法” $\binom{n+k-1}{k-1}$。
    对于第 $i$ 种物品，其选择方案的生成函数是 $(1+x+x^2+\dots) = \frac{1}{1-x}$。根据乘法原理， $k$ 种物品的总生成函数是 $(\frac{1}{1-x})^k$。


### 1.4 OGF的应用

#### 1.4.1 组合计数问题 (选取问题)

**问题1**: 有红、黄、蓝三种颜色的球，红球至少选1个，黄球至多选2个，蓝球只能选偶数个。问选出 $n$ 个球的方案数 $a_n$ 是多少？求 $A(x)$。

*   红球: $x^1 + x^2 + x^3 + \dots = x(1+x+x^2+\dots) = \frac{x}{1-x}$

*   黄球: $x^0 + x^1 + x^2 = 1+x+x^2 = \frac{1-x^3}{1-x}$

*   蓝球: $x^0 + x^2 + x^4 + \dots = 1+x^2+x^4+\dots = \frac{1}{1-x^2}$

根据乘法原理，总的生成函数 $A(x)$ 是三者之积：

$$ A(x) = \frac{x}{1-x} \cdot \frac{1-x^3}{1-x} \cdot \frac{1}{1-x^2} = \frac{x(1-x^3)}{(1-x)^2(1-x^2)} = \frac{x(1-x)(1+x+x^2)}{(1-x)^2(1-x)(1+x)} = \frac{x(1+x+x^2)}{(1-x)^2(1+x)} $$

要得到 $a_n$，需要将 $A(x)$ 展开为幂级数，然后提取 $x^n$ 的系数。这通常需要使用部分分式分解。


#### 1.4.2 整数分拆问题

将正整数 $n$ 表示成若干正整数之和（顺序无关）称为 $n$ 的一个分拆。
例如，整数 4 的分拆有：
4
3+1
2+2
2+1+1
1+1+1+1
共5种分拆。

*   **允许重复使用数的分拆**
    设 $p(n)$ 为 $n$ 的分拆数。其生成函数为：
    $$ P(x) = \prod_{k=1}^{\infty} (1+x^k+x^{2k}+x^{3k}+\dots) = \prod_{k=1}^{\infty} \frac{1}{1-x^k} $$
    $$ = (1+x+x^2+\dots)(1+x^2+x^4+\dots)(1+x^3+x^6+\dots)\dots $$
    第一个因子 $(1+x+x^2+\dots)$ 表示使用任意多个1。
    第二个因子 $(1+x^{2\cdot1}+x^{2\cdot2}+\dots)$ 表示使用任意多个2。
    ...
    第 $k$ 个因子 $(1+x^{k\cdot1}+x^{k\cdot2}+\dots)$ 表示使用任意多个 $k$。
    乘积中 $x^n$ 的系数即为 $p(n)$。

*   **分拆为互异的数**
    $$ P_d(x) = \prod_{k=1}^{\infty} (1+x^k) $$
    每个数 $k$ 最多只能选一次（要么不选 $x^0=1$，要么选一个 $x^k$）。

*   **分拆为奇数**
    $$ P_o(x) = \prod_{k=1}^{\infty} (1+x^{2k-1}+x^{2(2k-1)}+\dots) = \prod_{k=1}^{\infty} \frac{1}{1-x^{2k-1}} $$
    $$ = \frac{1}{(1-x)(1-x^3)(1-x^5)\dots} $$

有一个著名的欧拉定理：将 $n$ 分拆为互异整数的方案数等于将 $n$ 分拆为奇数部分的方案数。
即 $P_d(x) = P_o(x)$。
证明:
$$ P_d(x) = \prod_{k=1}^{\infty} (1+x^k) = \prod_{k=1}^{\infty} \frac{(1+x^k)(1-x^k)}{1-x^k} = \prod_{k=1}^{\infty} \frac{1-x^{2k}}{1-x^k} $$
$$ = \frac{(1-x^2)(1-x^4)(1-x^6)\dots}{(1-x)(1-x^2)(1-x^3)(1-x^4)\dots} = \frac{1}{(1-x)(1-x^3)(1-x^5)\dots} = P_o(x) $$


#### 1.4.3 求解线性常系数递推关系

考虑递推关系 $a_n = c_1 a_{n-1} + c_2 a_{n-2} + \dots + c_k a_{n-k}$ (其中 $n \ge k$)，以及初始条件 $a_0, a_1, \dots, a_{k-1}$。
设 $A(x) = \sum_{n=0}^{\infty} a_n x^n$。
将递推关系两边同乘以 $x^n$ 并对 $n$ 从 $k$ 到 $\infty$ 求和：
$$ \sum_{n=k}^{\infty} a_n x^n = c_1 \sum_{n=k}^{\infty} a_{n-1} x^n + c_2 \sum_{n=k}^{\infty} a_{n-2} x^n + \dots + c_k \sum_{n=k}^{\infty} a_{n-k} x^n $$

左边: $A(x) - \sum_{i=0}^{k-1} a_i x^i$
右边第 $j$ 项 ($1 \le j \le k$): $c_j \sum_{n=k}^{\infty} a_{n-j} x^n = c_j x^j \sum_{n=k}^{\infty} a_{n-j} x^{n-j} = c_j x^j \sum_{m=k-j}^{\infty} a_m x^m$
$$ = c_j x^j (A(x) - \sum_{i=0}^{k-j-1} a_i x^i) $$

整理后得到 $A(x)$ 的一个有理函数表达式：
$$ A(x) (1 - c_1 x - c_2 x^2 - \dots - c_k x^k) = P(x) $$
其中 $P(x)$ 是一个由初始条件决定的次数小于 $k$ 的多项式。
$$ A(x) = \frac{P(x)}{1 - c_1 x - c_2 x^2 - \dots - c_k x^k} $$
特征方程为 $r^k - c_1 r^{k-1} - \dots - c_k = 0$。
分母 $Q(x) = 1 - c_1 x - \dots - c_k x^k = x^k (\frac{1}{x^k} - c_1 \frac{1}{x^{k-1}} - \dots - c_k)$。
如果 $r_1, \dots, r_k$ 是特征方程的根，则 $1/r_1, \dots, 1/r_k$ 是 $Q(x)=0$ 的根。
即 $Q(x) = (1-r_1x)(1-r_2x)\dots(1-r_kx)$ （假设无重根）。
然后使用部分分式分解 $A(x) = \sum_{i=1}^k \frac{A_i}{1-r_i x}$，再利用 $\frac{1}{1-rx} = \sum_{j=0}^{\infty} (rx)^j$ 展开，即可得到 $a_n$ 的通项公式。

**例子: 斐波那契数列**
$F_0=0, F_1=1, F_n = F_{n-1} + F_{n-2}$ for $n \ge 2$.
设 $A(x) = \sum_{n=0}^{\infty} F_n x^n$.
$$ \sum_{n=2}^{\infty} F_n x^n = \sum_{n=2}^{\infty} F_{n-1} x^n + \sum_{n=2}^{\infty} F_{n-2} x^n $$
$$ A(x) - F_0 - F_1 x = x \sum_{n=2}^{\infty} F_{n-1} x^{n-1} + x^2 \sum_{n=2}^{\infty} F_{n-2} x^{n-2} $$
$$ A(x) - x = x (A(x) - F_0) + x^2 A(x) $$
$$ A(x) - x = x A(x) + x^2 A(x) $$
$$ A(x) (1 - x - x^2) = x $$
$$ A(x) = \frac{x}{1-x-x^2} $$
分母的根为 $1-x-x^2=0 \Rightarrow x^2+x-1=0 \Rightarrow x = \frac{-1 \pm \sqrt{5}}{2}$.
令 $\phi = \frac{1+\sqrt{5}}{2}$ (黄金分割比), $\psi = \frac{1-\sqrt{5}}{2}$.
则 $1-x-x^2 = -(x - \frac{-1+\sqrt{5}}{2})(x - \frac{-1-\sqrt{5}}{2}) = (1-\phi x)(1-\psi x)$.
（注意 $1/ \phi = \frac{2}{1+\sqrt{5}} = \frac{2(1-\sqrt{5})}{1-5} = \frac{1-\sqrt{5}}{-2} = \frac{-1+\sqrt{5}}{2}$， $1/\psi = \frac{-1-\sqrt{5}}{2}$）
$$ A(x) = \frac{x}{(1-\phi x)(1-\psi x)} = \frac{C_1}{1-\phi x} + \frac{C_2}{1-\psi x} $$
$x = C_1(1-\psi x) + C_2(1-\phi x)$
令 $x=1/\phi$: $1/\phi = C_1(1-\psi/\phi) \Rightarrow C_1 = \frac{1/\phi}{1-\psi/\phi} = \frac{1}{\phi-\psi} = \frac{1}{\sqrt{5}}$.
令 $x=1/\psi$: $1/\psi = C_2(1-\phi/\psi) \Rightarrow C_2 = \frac{1/\psi}{1-\phi/\psi} = \frac{1}{\psi-\phi} = -\frac{1}{\sqrt{5}}$.
$$ A(x) = \frac{1}{\sqrt{5}} \left( \frac{1}{1-\phi x} - \frac{1}{1-\psi x} \right) = \frac{1}{\sqrt{5}} \left( \sum_{n=0}^{\infty} (\phi x)^n - \sum_{n=0}^{\infty} (\psi x)^n \right) $$
$$ A(x) = \sum_{n=0}^{\infty} \frac{1}{\sqrt{5}} (\phi^n - \psi^n) x^n $$
所以 $F_n = [x^n]A(x) = \frac{1}{\sqrt{5}} (\phi^n - \psi^n) = \frac{1}{\sqrt{5}} \left( \left(\frac{1+\sqrt{5}}{2}\right)^n - \left(\frac{1-\sqrt{5}}{2}\right)^n \right)$.


## 2. 指数生成函数 (Exponential Generating Function, EGF)

### 2.1 定义

对于一个序列 $A = \{a_0, a_1, a_2, \dots, a_n, \dots\}$，它的指数生成函数定义为：
$$ \hat{A}(x) = \sum_{n=0}^{\infty} a_n \frac{x^n}{n!} $$
EGF 通常用于处理与**排列**（即有序）或**带标号对象**相关的组合问题。我们感兴趣的是 $\frac{x^n}{n!}$ 的系数 $[x^n/n!]\hat{A}(x) = a_n$。


### 2.2 基本运算及其组合意义

假设有两个序列 $A = \{a_n\}$ 和 $B = \{b_n\}$，它们的EGF分别为 $\hat{A}(x)$ 和 $\hat{B}(x)$。

1.  **加法**: $\hat{C}(x) = \hat{A}(x) + \hat{B}(x) = \sum_{n=0}^{\infty} (a_n + b_n) \frac{x^n}{n!}$
    则 $\hat{C}(x)$ 是序列 $\{a_n + b_n\}$ 的EGF。
    **组合意义**: 类似于OGF，表示“或”的关系。

2.  **乘法 (卷积)**:
    $$ \hat{C}(x) = \hat{A}(x)\hat{B}(x) = (\sum_{i=0}^{\infty} a_i \frac{x^i}{i!})(\sum_{j=0}^{\infty} b_j \frac{x^j}{j!}) = \sum_{n=0}^{\infty} (\sum_{k=0}^{n} a_k \frac{x^k}{k!} \cdot b_{n-k} \frac{x^{n-k}}{(n-k)!}) x^n $$
    $$ = \sum_{n=0}^{\infty} (\sum_{k=0}^{n} \frac{a_k b_{n-k}}{k!(n-k)!}) x^n = \sum_{n=0}^{\infty} (\sum_{k=0}^{n} \binom{n}{k} a_k b_{n-k}) \frac{x^n}{n!} $$
    则 $\hat{C}(x)$ 是序列 $C = \{c_n\}$ 的EGF，其中 $c_n = \sum_{k=0}^{n} \binom{n}{k} a_k b_{n-k}$。
    **组合意义**: 这是EGF的核心。如果 $a_k$ 是用 $k$ 个**不同**元素构造某种结构甲的方法数，$b_{n-k}$ 是用 $n-k$ 个**不同**元素构造某种结构乙的方法数。那么 $c_n$ 是用 $n$ 个**不同**元素构造一种复合结构的方法数：首先从 $n$ 个元素中选出 $k$ 个（$\binom{n}{k}$ 种方法），用这 $k$ 个元素构造结构甲（$a_k$ 种方法），然后用剩下的 $n-k$ 个元素构造结构乙（$b_{n-k}$ 种方法）。

3.  **求导**: $\hat{A}'(x) = \frac{d}{dx} \hat{A}(x) = \sum_{n=1}^{\infty} a_n \frac{n x^{n-1}}{n!} = \sum_{n=1}^{\infty} a_n \frac{x^{n-1}}{(n-1)!} = \sum_{m=0}^{\infty} a_{m+1} \frac{x^m}{m!}$
    则 $\hat{A}'(x)$ 是序列 $\{a_1, a_2, a_3, \dots\}$ (即 $\{a_{n+1}\}$) 的EGF。


### 2.3 常见的EGF及其封闭形式

1.  序列 $\{1, 1, 1, \dots\}$ (即 $a_n=1$ 对所有 $n \ge 0$):
    $$ \hat{A}(x) = \sum_{n=0}^{\infty} 1 \cdot \frac{x^n}{n!} = e^x $$
    **组合意义**: $a_n=1$ 表示 $n$ 个不同物品的排列只有一种方式（如果我们不关心它们的具体顺序，而是只关心如何将它们“标记”为这个结构）。更准确地说，如果 $a_n$ 是将 $n$ 个不同物体放入一个盒子的方案数（只有一种），其EGF是 $e^x$。

2.  序列 $\{0, 1, 1, \dots\}$ (即 $a_0=0, a_n=1$ 对所有 $n \ge 1$):
    $$ \hat{A}(x) = \sum_{n=1}^{\infty} 1 \cdot \frac{x^n}{n!} = e^x - 1 $$

3.  序列 $\{1, c, c^2, \dots\}$ (即 $a_n=c^n$ 对所有 $n \ge 0$):
    $$ \hat{A}(x) = \sum_{n=0}^{\infty} c^n \frac{x^n}{n!} = \sum_{n=0}^{\infty} \frac{(cx)^n}{n!} = e^{cx} $$

4.  序列 $\{1, 0, 1, 0, \dots\}$ ($a_n=1$ 若 $n$ 为偶数, $a_n=0$ 若 $n$ 为奇数):
    $$ \hat{A}(x) = \sum_{k=0}^{\infty} \frac{x^{2k}}{(2k)!} = \cosh(x) = \frac{e^x + e^{-x}}{2} $$

5.  序列 $\{0, 1, 0, 1, \dots\}$ ($a_n=1$ 若 $n$ 为奇数, $a_n=0$ 若 $n$ 为偶数):
    $$ \hat{A}(x) = \sum_{k=0}^{\infty} \frac{x^{2k+1}}{(2k+1)!} = \sinh(x) = \frac{e^x - e^{-x}}{2} $$

6.  特定项为1，其余为0： $a_k=1$, $a_n=0$ for $n \ne k$:
    $$ \hat{A}(x) = \frac{x^k}{k!} $$


### 2.4 EGF的应用

EGF主要用于涉及带标号对象的排列、组合问题。

**问题2**: 用红、黄、蓝三种颜色对 $n$ 个不同的球进行染色，要求红球的个数为偶数，黄球的个数为奇数，蓝球的个数任意。求染色方案数 $a_n$。

*   红球 (偶数个): $1 + \frac{x^2}{2!} + \frac{x^4}{4!} + \dots = \frac{e^x+e^{-x}}{2}$
    这里的 $x^k/k!$ 表示从 $k$ 个球中选出 $k$ 个染成红色 (只有一种选法)，因此系数是1。

*   黄球 (奇数个): $\frac{x^1}{1!} + \frac{x^3}{3!} + \frac{x^5}{5!} + \dots = \frac{e^x-e^{-x}}{2}$

*   蓝球 (任意个): $1 + \frac{x^1}{1!} + \frac{x^2}{2!} + \dots = e^x$

根据EGF的乘法原理，总的EGF $\hat{A}(x)$ 为三者之积：

$$ \hat{A}(x) = \left( \frac{e^x+e^{-x}}{2} \right) \left( \frac{e^x-e^{-x}}{2} \right) e^x $$
$$ = \frac{e^{2x} - e^{-2x}}{4} e^x = \frac{1}{4} (e^{3x} - e^{-x}) $$

现在展开这个EGF:
$$ \hat{A}(x) = \frac{1}{4} \left( \sum_{n=0}^{\infty} \frac{(3x)^n}{n!} - \sum_{n=0}^{\infty} \frac{(-x)^n}{n!} \right) $$
$$ = \frac{1}{4} \sum_{n=0}^{\infty} (3^n - (-1)^n) \frac{x^n}{n!} $$
所以，染色方案数 $a_n = [x^n/n!] \hat{A}(x) = \frac{1}{4} (3^n - (-1)^n)$.
例如，当 $n=1$ 时，$a_1 = \frac{1}{4}(3 - (-1)) = 1$。
方案：(黄)。红(0个,偶数)，黄(1个,奇数)，蓝(0个)。
当 $n=2$ 时，$a_2 = \frac{1}{4}(3^2 - (-1)^2) = \frac{1}{4}(9-1) = 2$。
方案：
1.  红球0个 (偶)，黄球1个 (奇)，蓝球1个。
    从2个球选1个黄 ($\binom{2}{1}$)，剩下1个蓝 ($\binom{1}{1}$)。$\binom{2}{1} \cdot 1 \cdot 1 = 2$ 种。
    (球1黄, 球2蓝), (球1蓝, 球2黄)。
2.  红球2个 (偶)，黄球0个 (不满足奇数)，蓝球0个。
3.  红球0个 (偶)，黄球2个 (不满足奇数)，蓝球0个。
等等，这里 $a_n = \frac{1}{4}(3^n - (-1)^n)$ 是最终的染色方案数。
例如 $n=2$时，(黄,蓝), (蓝,黄) 这两种是合法的。

**问题3: $n$ 位数的错排问题**
$D_n$ 表示 $n$ 个元素的错排数（即一个排列 $\pi$ 使得 $\pi(i) \ne i$ 对所有 $i$）。
考虑一个位置 $i$：
1.  元素 $i$ 不在自己的位置上。
每个元素 $j$ 可以放在位置 $j$ (对应 $\frac{x^1}{1!}$) 或者不放在位置 $j$ (对应 $1$)。
一个元素的EGF是 $(1+x)$。
但这不是错排。
考虑错排的结构，一个排列可以分解为若干个循环。错排是指所有循环的长度都 $\ge 2$。
长度为 $k$ 的循环的个数是 $(k-1)!$ (对于 $k$ 个给定的元素)。
所以构造一个长度为 $k (\ge 2)$ 的循环的EGF项是 $(k-1)! \frac{x^k}{k!} = \frac{x^k}{k}$。
所有可能的循环长度的EGF是 $\sum_{k=2}^{\infty} \frac{x^k}{k} = -\ln(1-x) - x$ (因为 $\ln(1-x) = -\sum_{k=1}^\infty \frac{x^k}{k}$)。
一个排列是若干个不相交循环的组合。如果 $\hat{C}(x)$ 是单个循环的EGF，那么排列的EGF是 $e^{\hat{C}(x)}$。
（这部分需要更严谨的组合类理论，暂时跳过，用更直接的包含排斥原理的EGF）

一个更常见的方法是使用指数生成函数和容斥原理。
设 $a_n$ 是 $n$ 个元素中，满足特定性质 $P$ 的排列数量。
总排列数是 $n!$。其EGF是 $\sum n! \frac{x^n}{n!} = \sum x^n = \frac{1}{1-x}$。
对于错排 $D_n$:
$D_n = n! \sum_{k=0}^n \frac{(-1)^k}{k!}$
其EGF $\hat{D}(x) = \sum_{n=0}^{\infty} D_n \frac{x^n}{n!} = \sum_{n=0}^{\infty} (n! \sum_{k=0}^n \frac{(-1)^k}{k!}) \frac{x^n}{n!}$
$$ = \sum_{n=0}^{\infty} (\sum_{k=0}^n \frac{(-1)^k}{k!}) x^n $$
这是 $e^{-x} = \sum_{k=0}^{\infty} \frac{(-1)^k x^k}{k!}$ 与 $\frac{1}{1-x} = \sum_{j=0}^{\infty} x^j$ 的卷积。
$$ \hat{D}(x) = e^{-x} \cdot \frac{1}{1-x} $$
$D_0=1$ (空排列是错排)。$\hat{D}(x) = 1 + 0\frac{x}{1!} + 1\frac{x^2}{2!} + 2\frac{x^3}{3!} + 9\frac{x^4}{4!} + \dots$
$$ = \frac{e^{-x}}{1-x} $$
这个结果的意义是：将 $n$ 个元素分成两组，一组形成错排，另一组形成恒等排列（每个元素都在自己位置上）。
恒等排列的EGF是 $e^x$ (每个元素选或不选，选了就固定)。
这与直观理解有出入，但公式 $\hat{D}(x) = \frac{e^{-x}}{1-x}$ 是对的。
$[x^n/n!] \frac{e^{-x}}{1-x} = D_n$.


## 3. OGF与EGF的选择

*   **OGF**: 当问题涉及**无标号**对象的组合、选择、分拆，且**顺序无关**时使用。例如：
    *   从不同种类的物品中选取若干个，每种物品数量有无限个或有限个限制。
    *   整数分拆。
    *   路径计数 (如Dyck路)。
    *   找零钱问题。

*   **EGF**: 当问题涉及**有标号**对象的排列、组合，且**顺序有关**（或结构需要区分元素）时使用。例如：
    *   $n$ 个不同的人排列成一排，满足某些限制。
    *   用 $n$ 个不同珠子串成项链/手镯（需要伯恩赛德引理或Polya定理，更复杂）。
    *   将 $n$ 个不同的球放入不同的盒子，盒子或球有特定限制。
    *   $n$ 个元素的错排问题。
    *   构建树、图等带标号的结构。

关键区别在于EGF的乘法卷积项 $\binom{n}{k}$，它代表了从 $n$ 个带标号对象中选取 $k$ 个用于第一部分，剩下 $n-k$ 个用于第二部分的过程。OGF的乘法没有这个组合系数，意味着对象是不可区分的，或者说标号信息在组合过程中不重要或已经被处理。


## 4. 提取系数的技巧

得到生成函数的封闭形式后，关键一步是提取特定项的系数。

1.  **直接展开/泰勒级数**: 如果函数形式简单，如 $(1-x)^{-k}$ 或 $e^{ax}$。

2.  **部分分式分解**: 对于有理函数 $P(x)/Q(x)$，将 $Q(x)$ 分解因式 $(1-r_ix)^{m_i}$，然后将 $P(x)/Q(x)$ 分解为 $\sum \frac{A_{ij}}{(1-r_ix)^j}$ 的形式，再利用 $(1-rx)^{-j} = \sum_{n=0}^{\infty} \binom{n+j-1}{j-1} (rx)^n$ 展开。

3.  **牛顿广义二项式定理**: $(1+y)^\alpha = \sum_{n=0}^\infty \binom{\alpha}{n} y^n$，其中 $\binom{\alpha}{n} = \frac{\alpha(\alpha-1)\dots(\alpha-n+1)}{n!}$。
    例如 $(1-x)^{-k} = \sum_{n=0}^\infty \binom{-k}{n} (-x)^n = \sum_{n=0}^\infty \frac{(-k)(-k-1)\dots(-k-n+1)}{n!} (-1)^n x^n = \sum_{n=0}^\infty \frac{k(k+1)\dots(k+n-1)}{n!} x^n = \sum_{n=0}^\infty \binom{n+k-1}{n} x^n$.

4.  **拉格朗日反演**: 用于求解形如 $F(x) = x G(F(x))$ 的函数方程的系数。

5.  **特殊技巧**: 例如，对于 $\frac{1}{(1-x)(1-x^2)\dots(1-x^m)}$ 这类与分拆相关的，有时没有简单的封闭通项公式，但可以递推计算。


## 5. 总结

生成函数是组合数学中一个非常强大的工具。它提供了一种系统性的方法来：

1.  **表示组合对象**: 将计数序列转化为代数对象。

2.  **利用代数运算解决组合问题**: 乘法对应组合操作的“和”（卷积），加法对应“或”。

3.  **求解递推关系**: 将递推关系转化为代数方程。

4.  **统一视角**: 许多看似不同的组合问题可以通过生成函数找到内在联系。

掌握生成函数的关键在于：

*   理解OGF和EGF的定义及其系数的组合意义。

*   熟悉常见序列的生成函数封闭形式。

*   熟练运用生成函数的代数运算及其组合解释，特别是乘法法则。

*   能够根据问题描述建立正确的生成函数模型。

*   掌握从生成函数封闭形式中提取系数的技巧。

虽然初学时可能会觉得抽象，但通过大量的练习和对典型例题的揣摩，可以逐渐体会到生成函数的精妙之处和威力。它是连接组合分析与代数分析的桥梁。

---